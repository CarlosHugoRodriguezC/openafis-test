const { findMatch } = require('./index.js');

// Test fingerprints from your data
const testFingerprint1 = "Rk1SACAyMAAAAAC6AAABAAFoAMUAxQEAAABkGkCJAC3qYEBDAECIYICRAFZoYIA/AGKGYEB/AHzqYEBzAIzoYEBSAIv1YEBpAJFzYIDHAJXdYIBKAKHxYIAvAK+VYIBaALTgYICGALfVYEBAANHkYEC1ANrRYIB7AOLJYEBEAOa5YECCAQHEYECXAQzKYIBfASKxYIB0ASO4YICOASzIYECBATi5YEBxAT41YECcAUTNYECSAU/CYAAA";

const testFingerprint2 = "Rk1SACAyMAAAAACiAAABAAFoAMUAxQEAAABkFoBsAB5uYEB+ACTgYEBSAGHmYEA8AIPkYEDFAI1KYECjAJNGYEA0AKLKYEBRAKvAYEAjALOiYIB+ALREYEAjALunYIBdAL+8YEAgAMirYEBIAOa3YIBeAO7CYIAeAQCpYIA+ARKxYEBLARnAYIBDASuzYIBMATXEYIBBAUGsYIBKAUzCYAAA";

// User database (from your fingerprints file)
const users = [
  {
    "id": 4,
    "type": 0,
    "user_id": 4,
    "client_id": null,
    "username": "dispatchertk",
    "email": "jazmin@teknik.mx",
    "date_formatted": "241104 11:06",
    "user": "Despachador Teknik",
    "employee_number": 123,
    "fingerprint": "Rk1SACAyMAAAAAGSAAABAAFoAMgAyAEAAABWPkCMARy9ZEB5AKN0YkBaAPrDYYAfAKqkX4AeAO61W0CvAKreW4BeAIiFWoBwAUaxWoBCAPfAWYBQADuFWEAwAImTWEBDANmwWEBKAFD/V4B/AUC2V4BOAT5FVkBQAS1FVYBAABZ+VYAWAIWYVEB4AEpuU0C2AOvQUoAeAJEQUkC1ATHHUkBoAG51UUBiAJjvUEBgALWUUIBYASFDUECgAERmT4BaAOC7T0CaAL7VToCeAI7jTIDBAMjaTEB8AOzHTICWAUg7TECwARLJS0C+AL5ZS4BUAVYwSkBmAFXsSUAyATpUSUBEAURLSEAYAF8LR0AQAFOQRUAEAKqeREBcAFKHQkBeAKfsQIAyABcDQIBkAE/zQIBkANrLPkCYASvEPEBEAVBQOIDAAQNRNoBUAGKHNgDKATrQNQAyAUnVNQBiAMKZNADSAN3cMwBiAM3ZMABMAOAkLwDNAPjVLgAWASvJLgDKAQpQKwDNAQbSKgBaANrJKgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA="
  },
  {
    "id": 2,
    "type": 2,
    "user_id": 712,
    "client_id": null,
    "username": "hardware",
    "email": "harware@teknik.dev",
    "date_formatted": "240607 08:12",
    "user": "Hardware Test",
    "employee_number": 100000,
    "fingerprint": "Rk1SACAyMAAAAAG2AAABAAFoAMgAyAEAAABWREC6AImCY0DYAFh7YEC0AEmNX4C2AFj7XIBtAJIjXIBhAMKtWoBVALWpWECuAMIGV0BPAMgrVoDSATCsVkBaAGcjVUBoACKlU0CSAOAqU4CCATFAU4CUADEQUoCQAFgSUkCFAQa9UUB8ANctUYBzATPFUIBqAEMgT0CpAIyVTkBmALYmToDmADt0ToDgAUa0TkDWAJfnTUDgAOLATUCpARJHTICKASHDTICiAQ3LSkBSAMEtSkCRAOgpSYC+AVojSEBmAN2uSIDaAQyyR4CWAQa/R0CvABCPRUDWALV5RYCkALYYRYDcASe5REDsAFDoQoCGAN23QoCoAQfEQoCQAURHQkCIAJ0hQoC4AU+iQYCwAPvIQYCAAQa9QUB2AS3FQUCoAUivQYDmALDjP0DEALKJP4DBAUIqP4CKAEoOPoA8AFsoPYCIAJcWPUCGAOK3PYBtAPu7PYDuAUC5PYCwASFCPEDIAQRTPECoAVwpPECUAURJO4CvAUYsO0DIABTyO4B8ALaoOoC7APfFOkDTAVioOkDYAKF5OgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA="
  },
  {
    "id": 1,
    "type": 1,
    "user_id": 712,
    "client_id": null,
    "username": "hardware",
    "email": "harware@teknik.dev",
    "date_formatted": "240604 10:28",
    "user": "Hardware Test",
    "employee_number": 100000,
    "fingerprint": "Rk1SACAyMAAAAAG2AAABAAFoAMgAyAEAAABWRECpAC6DZEBVAESdYUBmABQOW0CSADEDWkBuADQJWICRACKJWICSANy1V0BEAObLVoDuAHbgVYBwAEybU0DSAIjVUkB8AEAJUUBzAU4YUUCmAHrnUEBIANY0UICyABb5T4A0AIIpT4CUAKesTkB5ANAyTYCRALK1TIAuARNATIBSANa1SoB+ADKNSIBuAPq8R0CEAQ+5R4CCALAjRkArAP3HRUASAMS8RIBtASfOQ4AeAUBMQ0BkAQRNQoBVASVQQYBAATbYQUCRAVYYQUCeATCjQEBQAMe3QIBOAOhEQEA2AVJtQICXAFsDP4BQAO9DP4A4AQ3JP0CLAVgaP4B5AJUhP0ATAE0kPkBgAK8pPUB6ALW1PYBiALswPYCwATA5PYB8ATNFPYAcAD2nPIBhAMi7PIAaASfOPIB+AJEUPEA3AK+1PICqAK/HPEBnAL4vPIBbAQPQPIAOAJsnO0AeAKq5O4AoAQTNO0BAASLbO4BWASpYO4BIAQHHOkCRASIwOoBhATlvOoBYAOLAOkB0APq5OoAZAEohOQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA="
  },
  {
    "id": 3,
    "type": 2,
    "user_id": 952,
    "client_id": null,
    "username": "100002",
    "email": "hardware2@teknik.mx",
    "date_formatted": "240621 08:44",
    "user": "Ryan Test",
    "employee_number": 100002,
    "fingerprint": "Rk1SACAyMAAAAAD8AAABAAFoAMgAyAEAAABWJUDKAStaY0CRASjTWkBbAIiHWUCkAPvgWECQAHZ9V0DHAU7PV0BcAE2NVkB2AHr9VkB+ALjpVUBbAHqCVEBWADIAVEAwAMcQVEDuAOhgVIBoANHuU0DgASfTU0BzAJLzUkDiANneUUDWAD5tUEBUAOL1UECiABf1UIBIAFULUEBsAKCDUEBOAHwDT4BYAPTuT0DiADToTUAyAP4LTUBWAKMGTIBGARnuSkB4ASXQSoCFADL7SIDkAF/pSEC2AE91RkAoAGSTQYAQARwhPkBJAUaoPoA9AGUHOgBMAUDAMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA="
  },
  {
    "id": 5,
    "type": 0,
    "user_id": 5,
    "client_id": null,
    "username": "cahuroca",
    "email": "cahuroca.aw@gmail.com",
    "date_formatted": "250725 00:19",
    "user": "Carlos",
    "employee_number": 123456,
    "fingerprint": "Rk1SACAyMAAAAACuAAABAAFoAMUAxQEAAABaGECyAD3rYEBwAFGIYIC+AGZqYIBrAHOGYECqAInrYECfAJnqYEB8AJj3YECUAJ51YEB4ALHxYEBbAMGZYECGAMPeYECyAMfVYEBuAN3kYEDgAOXRYICpAO3HYEByAPG7YECvAQ/EYEDDARbKYIChAS64YECQATGvYEC+ATbIYECuAUO3YECgAUg3YEDIAU7NYAAA",
    "lastAccess": "2025-07-25T00:28:52.491Z"
  }
];

console.log("Testing fingerprint matching...\n");

// Test first fingerprint
console.log("Testing first fingerprint:");
console.log("Fingerprint 1:", testFingerprint1.substring(0, 50) + "...");
const match1 = findMatch(testFingerprint1, users);
console.log("Match result:", match1 ? `User: ${match1.user} (ID: ${match1.id})` : "No match found");

console.log("\n" + "=".repeat(60) + "\n");

// Test second fingerprint
console.log("Testing second fingerprint:");
console.log("Fingerprint 2:", testFingerprint2.substring(0, 50) + "...");
const match2 = findMatch(testFingerprint2, users);
console.log("Match result:", match2 ? `User: ${match2.user} (ID: ${match2.id})` : "No match found");

console.log("\n" + "=".repeat(60) + "\n");

// Compare the fingerprints directly
console.log("Direct comparison of the two test fingerprints:");
console.log("Fingerprint 1 length:", testFingerprint1.length);
console.log("Fingerprint 2 length:", testFingerprint2.length);
console.log("Are they identical?", testFingerprint1 === testFingerprint2);

// Extract some header information (ISO 19794-2 format analysis)
console.log("\nAnalyzing fingerprint headers:");
function analyzeFingerprint(fp, name) {
    const decoded = Buffer.from(fp, 'base64');
    console.log(`${name}:`);
    console.log(`  Total length: ${decoded.length} bytes`);
    console.log(`  Header: ${decoded.slice(0, 8).toString('hex')}`);
    
    // ISO 19794-2 header analysis
    if (decoded.length >= 28) {
        const recordLength = decoded.readUInt32BE(8);
        const numViews = decoded.readUInt8(28);
        console.log(`  Record length: ${recordLength}`);
        console.log(`  Number of finger views: ${numViews}`);
    }
}

analyzeFingerprint(testFingerprint1, "Test Fingerprint 1");
analyzeFingerprint(testFingerprint2, "Test Fingerprint 2");
analyzeFingerprint(users[4].fingerprint, "Carlos's stored fingerprint");
